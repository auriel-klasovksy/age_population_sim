<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Age population sim</title>

    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
    <style>
        #container {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div id="container">
        <p id="sum"></p>
        <div id="plotdiv"></div>
        <button onclick="step(starting_conditions)">Next 10 years</button>
    </div>

    <script>
        
        const furtile_index = 3
        const baby_ratio = 3/2
        const natural_death_perc = [13,10,5,5,20,20,25,30]
        var starting_conditions = [5,15,25,10,20,15,10,10]
        
        const total_view = document.getElementById("sum") 
        
        plot_people(starting_conditions)
        show_sum(starting_conditions)

        function step(array) {
            natural_death(array,natural_death_perc)
            let babies = get_babies(array, furtile_index, baby_ratio)
            age_people(array)
            array[0] = babies
            plot_people(array)
            show_sum(array)
        }

        function natural_death(array,death_perc) {
            for (let i = 0; i < array.length; i++) {
                array[i] =  array[i] * (1 - death_perc[i]/100)
            }
        }

        function age_people(array) {
            var new_val = 0;
            for (let i = 0; i < array.length; i++) {
                let old_val = array[i];
                array[i] = new_val;
                new_val = old_val
            }
        }
        function get_babies(array, furtile_index, baby_ratio) {
            return array[furtile_index] * baby_ratio
        }

        function show_sum(array) {
            total_view.innerText = array.reduce((partialSum, a) => partialSum + a, 0);
        }

        function plot_people(people) {
            var gd = document.getElementById('plotdiv');

            var people_amount = people
            var ages = [
                    "0-10",
                    "11-20",
                    "21-30",
                    "31-40",
                    "41-50",
                    "51-60",
                    "61-70",
                    "71-80"
                ]
            var data = [{
                type: 'funnel',
                y: ages,
                x: people_amount,
                textposition: "inside", 
                textinfo: "value",
                marker: {color: [ "#292f56", "#154b7a", "#006a94", "#00889f", "#00a6a4", "#00c79c", "#54e387", "#acfa70", ],
                line: {"width": [1], color: ["000000"]}},
                connector: {line: {color: "royalblue", dash: "dot", width: 3}},
                hoverinfo:'skip',
            }];
            const config = {
                displayModeBar: false, // this is the line that hides the bar.
            };

            var layout = {margin: {l: 100}, width: 600, height: 500,
                xaxis: {
                    fixedrange: true
                },
                yaxis: {
                    fixedrange: true
                }
            }

            Plotly.newPlot('plotdiv', data, layout,config);

           
        }

    </script>
</body>
</html>
